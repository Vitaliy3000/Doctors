{"ast":null,"code":"import { saveUserData } from '../authorization/actions';\nconst PROXY_URL = \"https://proxy-q-doctor.herokuapp.com/api/emias/\";\nconst SCHEDULE_URL = \"schedule\";\n\nfunction saveSession(omsNumber, birthDate, schedule) {\n  localStorage.setItem('omsNumber', omsNumber);\n  localStorage.setItem('birthDate', birthDate);\n  localStorage.setItem('schedule', schedule);\n}\n\nfunction dropSession() {\n  localStorage.clear();\n}\n\nfunction getSchedule(omsNumber, birthDate) {\n  return fetch(PROXY_URL + SCHEDULE_URL + \"?oms_number=\".concat(omsNumber, \"&birth_date=\").concat(birthDate), {\n    method: 'GET',\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  });\n}\n\n;\nexport const loadSchedule = payload => {\n  return function (dispatch) {\n    dispatch(loadScheduleAction);\n\n    if (localStorage.getItem('omsNumber')) {\n      dispatch(loadScheduleSuccess(JSON.parse(localStorage.getItem('schedule'))));\n      dispatch(saveUserData([localStorage.getItem('omsNumber'), localStorage.getItem('birthDate')]));\n    }\n\n    return getSchedule(...payload).then(response => {\n      if (response.status !== 200) {\n        throw 'Ошибка авторизации';\n      }\n\n      ;\n      return response;\n    }).then(response => response.json()).then(response => {\n      dispatch(loadScheduleSuccess(response));\n      dispatch(saveUserData(payload));\n      saveSession(omsNumber, birthDate, response);\n    }).catch(error => dispatch(loadScheduleFailureAction));\n  };\n};\nexport const loadScheduleAction = {\n  type: 'LOAD_SCHEDULE',\n  payload: null\n};\nexport const loadScheduleFailureAction = {\n  type: 'LOAD_SCHEDULE_FAILURE',\n  payload: 'Авторизация завершилась с ошибкой'\n};\nexport const loadScheduleSuccess = payload => {\n  console.log('action', JSON.parse(JSON.stringify(payload)));\n  return {\n    type: 'LOAD_SCHEDULE_SUCCESS',\n    payload: payload\n  };\n};\nexport const closeBanner = {\n  type: 'RESET_SCHEDULE',\n  payload: null\n};","map":{"version":3,"sources":["/Users/17476018U/Google Диск/Projects/Frontend/Project/DoctorsFront/src/redux/schedule/actions.js"],"names":["saveUserData","PROXY_URL","SCHEDULE_URL","saveSession","omsNumber","birthDate","schedule","localStorage","setItem","dropSession","clear","getSchedule","fetch","method","headers","loadSchedule","payload","dispatch","loadScheduleAction","getItem","loadScheduleSuccess","JSON","parse","then","response","status","json","catch","error","loadScheduleFailureAction","type","console","log","stringify","closeBanner"],"mappings":"AAAA,SAAQA,YAAR,QAA2B,0BAA3B;AAEA,MAAMC,SAAS,GAAG,iDAAlB;AACA,MAAMC,YAAY,GAAG,UAArB;;AAGA,SAASC,WAAT,CAAqBC,SAArB,EAAgCC,SAAhC,EAA2CC,QAA3C,EAAqD;AACpDC,EAAAA,YAAY,CAACC,OAAb,CAAqB,WAArB,EAAkCJ,SAAlC;AACAG,EAAAA,YAAY,CAACC,OAAb,CAAqB,WAArB,EAAkCH,SAAlC;AACAE,EAAAA,YAAY,CAACC,OAAb,CAAqB,UAArB,EAAiCF,QAAjC;AACA;;AAED,SAASG,WAAT,GAAuB;AACtBF,EAAAA,YAAY,CAACG,KAAb;AACA;;AAGD,SAASC,WAAT,CAAqBP,SAArB,EAAgCC,SAAhC,EAA2C;AACzC,SAAOO,KAAK,CACVX,SAAS,GAACC,YAAV,yBAAsCE,SAAtC,yBAA8DC,SAA9D,CADU,EAEV;AACEQ,IAAAA,MAAM,EAAE,KADV;AAEEC,IAAAA,OAAO,EAAE;AAAC,sBAAgB;AAAjB;AAFX,GAFU,CAAZ;AAOD;;AAAA;AAGD,OAAO,MAAMC,YAAY,GAAGC,OAAO,IAAI;AACtC,SAAO,UAASC,QAAT,EAAmB;AACvBA,IAAAA,QAAQ,CAACC,kBAAD,CAAR;;AAEA,QAAIX,YAAY,CAACY,OAAb,CAAqB,WAArB,CAAJ,EAAuC;AACrCF,MAAAA,QAAQ,CAACG,mBAAmB,CAACC,IAAI,CAACC,KAAL,CAAWf,YAAY,CAACY,OAAb,CAAqB,UAArB,CAAX,CAAD,CAApB,CAAR;AACAF,MAAAA,QAAQ,CAACjB,YAAY,CAAC,CAACO,YAAY,CAACY,OAAb,CAAqB,WAArB,CAAD,EAAoCZ,YAAY,CAACY,OAAb,CAAqB,WAArB,CAApC,CAAD,CAAb,CAAR;AACD;;AAED,WAAOR,WAAW,CAAC,GAAGK,OAAJ,CAAX,CACEO,IADF,CACOC,QAAQ,IAAI;AAChB,UAAIA,QAAQ,CAACC,MAAT,KAAoB,GAAxB,EAA6B;AAAC,cAAM,oBAAN;AAA2B;;AAAA;AACzD,aAAOD,QAAP;AACD,KAJF,EAKED,IALF,CAKOC,QAAQ,IAAIA,QAAQ,CAACE,IAAT,EALnB,EAMEH,IANF,CAMOC,QAAQ,IAAI;AAChBP,MAAAA,QAAQ,CAACG,mBAAmB,CAACI,QAAD,CAApB,CAAR;AACAP,MAAAA,QAAQ,CAACjB,YAAY,CAACgB,OAAD,CAAb,CAAR;AACAb,MAAAA,WAAW,CAACC,SAAD,EAAYC,SAAZ,EAAuBmB,QAAvB,CAAX;AAA4C,KAT/C,EAUEG,KAVF,CAUQC,KAAK,IAAIX,QAAQ,CAACY,yBAAD,CAVzB,CAAP;AAWF,GAnBD;AAoBA,CArBM;AAuBP,OAAO,MAAMX,kBAAkB,GAAG;AACjCY,EAAAA,IAAI,EAAE,eAD2B;AAEjCd,EAAAA,OAAO,EAAE;AAFwB,CAA3B;AAKP,OAAO,MAAMa,yBAAyB,GAAG;AACxCC,EAAAA,IAAI,EAAE,uBADkC;AAExCd,EAAAA,OAAO,EAAE;AAF+B,CAAlC;AAKP,OAAO,MAAMI,mBAAmB,GAAGJ,OAAO,IAAI;AAC5Ce,EAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ,EAAsBX,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACY,SAAL,CAAejB,OAAf,CAAX,CAAtB;AACA,SAAQ;AACTc,IAAAA,IAAI,EAAE,uBADG;AAETd,IAAAA,OAAO,EAAEA;AAFA,GAAR;AAGE,CALG;AAOP,OAAO,MAAMkB,WAAW,GAAG;AACzBJ,EAAAA,IAAI,EAAE,gBADmB;AAEzBd,EAAAA,OAAO,EAAE;AAFgB,CAApB","sourcesContent":["import {saveUserData} from '../authorization/actions'\n\nconst PROXY_URL = \"https://proxy-q-doctor.herokuapp.com/api/emias/\"\nconst SCHEDULE_URL = \"schedule\"\n\n\nfunction saveSession(omsNumber, birthDate, schedule) {\n\tlocalStorage.setItem('omsNumber', omsNumber);\n\tlocalStorage.setItem('birthDate', birthDate);\n\tlocalStorage.setItem('schedule', schedule);\n}\n\nfunction dropSession() {\n\tlocalStorage.clear();\n}\n\n\nfunction getSchedule(omsNumber, birthDate) {\n  return fetch(\n    PROXY_URL+SCHEDULE_URL+`?oms_number=${omsNumber}&birth_date=${birthDate}`,\n    {\n      method: 'GET',\n      headers: {'Content-Type': 'application/json'},\n    },\n  );\n};\n\n\nexport const loadSchedule = payload => {\n\treturn function(dispatch) {\n    dispatch(loadScheduleAction);\n\n    if (localStorage.getItem('omsNumber')) {\n      dispatch(loadScheduleSuccess(JSON.parse(localStorage.getItem('schedule'))));\n      dispatch(saveUserData([localStorage.getItem('omsNumber'), localStorage.getItem('birthDate')]));\n    }\n\n    return getSchedule(...payload)\n            .then(response => {\n              if (response.status !== 200) {throw 'Ошибка авторизации'};\n              return response\n            })\n            .then(response => response.json())\n            .then(response => {\n              dispatch(loadScheduleSuccess(response));\n              dispatch(saveUserData(payload));\n              saveSession(omsNumber, birthDate, response)})\n            .catch(error => dispatch(loadScheduleFailureAction));\n\t};\n};\n\nexport const loadScheduleAction = {\n\ttype: 'LOAD_SCHEDULE',\n\tpayload: null,\n};\n\nexport const loadScheduleFailureAction = {\n\ttype: 'LOAD_SCHEDULE_FAILURE',\n\tpayload: 'Авторизация завершилась с ошибкой',\n};\n\nexport const loadScheduleSuccess = payload => {\n  console.log('action', JSON.parse(JSON.stringify(payload)))\n  return ({\n\ttype: 'LOAD_SCHEDULE_SUCCESS',\n\tpayload: payload,\n});}\n\nexport const closeBanner = {\n  type: 'RESET_SCHEDULE',\n  payload: null,\n}"]},"metadata":{},"sourceType":"module"}