{"ast":null,"code":"import _defineProperty from \"/Users/17476018U/Google \\u0414\\u0438\\u0441\\u043A/Projects/Frontend/Project/DoctorsFront/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/Users/17476018U/Google \\u0414\\u0438\\u0441\\u043A/Projects/Frontend/Project/DoctorsFront/src/components/Schedule/Schedule.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React from 'react';\nimport styles from './Schedule.module.css';\nimport Department from './Department/Department';\nimport Doctor from './Doctor/Doctor';\nimport ScheduleFrame from './ScheduleFrame/ScheduleFrame';\nconst BASE_URL = \"https://proxy-q-doctor.herokuapp.com/api/emias/\";\nconst DEPARTMENT_URL = \"departments\";\nconst DOCTOR_URL = \"doctors/\";\nconst SCHEDULE_URL = \"schedule\";\nconst CACHE_URL = \"check_cache\";\nexport default class Schedule extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      departments: [],\n      doctors: [],\n      schedule: [],\n      department: '',\n      doctor: ''\n    };\n    this.handleClickDepartment = this.handleClickDepartment.bind(this);\n    this.handleClickDoctor = this.handleClickDoctor.bind(this);\n  }\n\n  fetchDepartments(oms_number, birth_date) {\n    return fetch(BASE_URL + DEPARTMENT_URL + \"?oms_number=\".concat(oms_number, \"&birth_date=\").concat(birth_date)).then(response => response.json()).then(response => localStorage.setItem('departments', JSON.stringify(response))).then(r => this.setState(_objectSpread({}, this.state, {\n      departments: JSON.parse(localStorage.getItem('departments'))\n    })));\n  }\n\n  fetchCacheCheck(oms_number, birth_date) {\n    fetch(BASE_URL + CACHE_URL + \"?oms_number=\".concat(oms_number, \"&birth_date=\").concat(birth_date));\n  }\n\n  fetchDoctors(oms_number, birth_date, speciality_id) {\n    return fetch(BASE_URL + DOCTOR_URL + speciality_id + \"?oms_number=\".concat(oms_number, \"&birth_date=\").concat(birth_date)).then(response => response.json()).then(response => localStorage.setItem('doctors' + speciality_id, JSON.stringify(response))).then(r => this.setState(_objectSpread({}, this.state, {\n      doctors: JSON.parse(localStorage.getItem('doctors' + speciality_id))\n    })));\n  }\n\n  fetchSchedule(doctor) {\n    const available_resource_id = doctor['lpuRoomsInfo']['lpuRoomView'][0]['availableResourceId'];\n    const lpu_id = doctor['lpuRoomsInfo']['lpuRoomView'][0]['lpuId'];\n    return fetch(BASE_URL + SCHEDULE_URL + \"?available_resource_id=\".concat(available_resource_id, \"&lpu_id=\").concat(lpu_id)).then(response => response.json()).then(response => this.setState(_objectSpread({}, this.state, {\n      schedule: response,\n      doctors: []\n    }))).catch(err => this.setState(_objectSpread({}, this.state, {\n      schedule: []\n    })));\n  }\n\n  componentDidMount() {\n    this.fetchDepartments(localStorage.getItem('omsNumber'), localStorage.getItem('birthDate'));\n    this.fetchCacheCheck(localStorage.getItem('omsNumber'), localStorage.getItem('birthDate'));\n  }\n\n  componentDidUpdate(prevProps, prevState, snapshot) {\n    if (this.state.department !== prevState.department) {\n      this.fetchDoctors(localStorage.getItem('omsNumber'), localStorage.getItem('birthDate'), this.state.department);\n    }\n\n    if (this.state.doctor !== prevState.doctor) {\n      // console.log('Doctors: ', this.state.doctor, prevState.doctor)\n      // console.log(prevState.doctor)\n      // console.log(this.state.doctor)\n      this.fetchSchedule(this.state.doctors.filter(x => x['id'] === this.state.doctor)[0]);\n    }\n  }\n\n  handleClickDepartment(element) {\n    if (this.state.department !== element) {\n      this.setState(_objectSpread({}, this.state, {\n        department: element,\n        doctors: [],\n        schedule: []\n      }));\n    }\n  }\n\n  handleClickDoctor(element) {\n    if (this.state.doctor !== element) {\n      this.setState(_objectSpread({}, this.state, {\n        doctor: element,\n        schedule: []\n      }));\n    }\n  }\n\n  render() {\n    console.log(this.state);\n    return React.createElement(\"div\", {\n      className: styles.schedule,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 85\n      },\n      __self: this\n    }, this.state.departments.length !== 0 && React.createElement(Department, {\n      items: this.state.departments,\n      handleClick: this.handleClickDepartment,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 86\n      },\n      __self: this\n    }), this.state.doctors.length !== 0 && React.createElement(Doctor, {\n      items: this.state.doctors,\n      handleClick: this.handleClickDoctor,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 87\n      },\n      __self: this\n    }), this.state.schedule.length !== 0 && React.createElement(ScheduleFrame, {\n      items: this.state.schedule,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 88\n      },\n      __self: this\n    }));\n  }\n\n}\n;","map":{"version":3,"sources":["/Users/17476018U/Google Диск/Projects/Frontend/Project/DoctorsFront/src/components/Schedule/Schedule.js"],"names":["React","styles","Department","Doctor","ScheduleFrame","BASE_URL","DEPARTMENT_URL","DOCTOR_URL","SCHEDULE_URL","CACHE_URL","Schedule","Component","constructor","props","state","departments","doctors","schedule","department","doctor","handleClickDepartment","bind","handleClickDoctor","fetchDepartments","oms_number","birth_date","fetch","then","response","json","localStorage","setItem","JSON","stringify","r","setState","parse","getItem","fetchCacheCheck","fetchDoctors","speciality_id","fetchSchedule","available_resource_id","lpu_id","catch","err","componentDidMount","componentDidUpdate","prevProps","prevState","snapshot","filter","x","element","render","console","log","length"],"mappings":"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","sourcesContent":["import React from 'react';\n\nimport styles from './Schedule.module.css';\n\nimport Department from './Department/Department';\nimport Doctor from './Doctor/Doctor';\nimport ScheduleFrame from './ScheduleFrame/ScheduleFrame';\n\nconst BASE_URL = \"https://proxy-q-doctor.herokuapp.com/api/emias/\"\nconst DEPARTMENT_URL = \"departments\"\nconst DOCTOR_URL = \"doctors/\"\nconst SCHEDULE_URL = \"schedule\"\nconst CACHE_URL = \"check_cache\"\n\n\nexport default class Schedule extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.state = {departments: [], doctors: [], schedule: [], department: '', doctor: ''}\n\n\t\tthis.handleClickDepartment = this.handleClickDepartment.bind(this);\n\t\tthis.handleClickDoctor = this.handleClickDoctor.bind(this);\n\t}\n\n\tfetchDepartments(oms_number, birth_date) {\n\t\treturn fetch(BASE_URL+DEPARTMENT_URL+`?oms_number=${oms_number}&birth_date=${birth_date}`)\n\t\t\t\t\t\t.then(response => response.json())\n\t\t\t\t\t\t.then(response => localStorage.setItem('departments', JSON.stringify(response)))\n\t\t\t\t\t\t.then(r => this.setState({ ...this.state, departments: JSON.parse(localStorage.getItem('departments'))}));\n\t}\n\n\tfetchCacheCheck(oms_number, birth_date) {\n\t\tfetch(BASE_URL+CACHE_URL+`?oms_number=${oms_number}&birth_date=${birth_date}`)\n\t}\n\n\tfetchDoctors(oms_number, birth_date, speciality_id) {\n\t\treturn fetch(BASE_URL+DOCTOR_URL+speciality_id+`?oms_number=${oms_number}&birth_date=${birth_date}`)\n\t\t\t\t\t\t.then(response => response.json())\n\t\t\t\t\t\t.then(response => localStorage.setItem('doctors'+speciality_id, JSON.stringify(response)))\n\t\t\t\t\t\t.then(r => this.setState({ ...this.state, doctors: JSON.parse(localStorage.getItem('doctors'+speciality_id))}));\n\t}\n\n\tfetchSchedule(doctor) {\n\t\tconst available_resource_id = doctor['lpuRoomsInfo']['lpuRoomView'][0]['availableResourceId']\n\t\tconst lpu_id = doctor['lpuRoomsInfo']['lpuRoomView'][0]['lpuId']\n\n\t\treturn fetch(BASE_URL+SCHEDULE_URL+`?available_resource_id=${available_resource_id}&lpu_id=${lpu_id}`)\n\t\t\t\t\t\t.then(response => response.json())\n\t\t\t\t\t\t.then(response => this.setState({...this.state, schedule: response, doctors: []}))\n\t\t\t\t\t\t.catch(err => this.setState({...this.state, schedule: []}));\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.fetchDepartments(localStorage.getItem('omsNumber'), localStorage.getItem('birthDate'));\n\t\tthis.fetchCacheCheck(localStorage.getItem('omsNumber'), localStorage.getItem('birthDate'));\n\t}\n\n\tcomponentDidUpdate(prevProps, prevState, snapshot) {\n\t\tif (this.state.department !== prevState.department) {\n\t\t\tthis.fetchDoctors(localStorage.getItem('omsNumber'), localStorage.getItem('birthDate'), this.state.department);\n\t\t}\n\n\t\tif (this.state.doctor !== prevState.doctor) {\n\t\t\t// console.log('Doctors: ', this.state.doctor, prevState.doctor)\n\t\t\t// console.log(prevState.doctor)\n\t\t\t// console.log(this.state.doctor)\n\t\t\tthis.fetchSchedule(this.state.doctors.filter(x => x['id']===this.state.doctor)[0]);\n\t\t}\n\t}\n\n\thandleClickDepartment(element) {\n\t\tif (this.state.department !== element) {\n\t\t\tthis.setState({...this.state, department: element, doctors: [], schedule: []})}\n\t}\n\n\thandleClickDoctor(element) {\n\t\tif (this.state.doctor !== element) {\n\t\t\tthis.setState({...this.state, doctor: element, schedule: []})}\n\t}\n\n  render() {\n\t\tconsole.log(this.state)\n\t\treturn (\n\t\t\t<div className={styles.schedule}>\n\t\t\t\t{this.state.departments.length !== 0 && <Department items={this.state.departments} handleClick={this.handleClickDepartment} />}\n\t\t\t\t{this.state.doctors.length !== 0 && <Doctor items={this.state.doctors} handleClick={this.handleClickDoctor} />}\n\t\t\t\t{this.state.schedule.length !== 0 && <ScheduleFrame items={this.state.schedule} />}\n\t\t\t</div>\n\t\t);\n\t};\n};"]},"metadata":{},"sourceType":"module"}