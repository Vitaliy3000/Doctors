{"ast":null,"code":"import _objectSpread from \"/Users/17476018U/Google \\u0414\\u0438\\u0441\\u043A/Projects/Frontend/Project/DoctorsFront/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nvar _jsxFileName = \"/Users/17476018U/Google \\u0414\\u0438\\u0441\\u043A/Projects/Frontend/Project/DoctorsFront/src/pages/AppointmentPage.js\";\nimport React from 'react';\nimport Tile from '../components/Tile/Tile';\nimport styles from './AppointmentPage.module.css';\nimport Spinner from 'react-bootstrap/Spinner';\nconst BASE_URL = \"https://back-q-doctor.herokuapp.com/api\";\nconst APPOINTMENT_URL = \"/people/appointments\";\nexport default class AppointmentPage extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      departments: [],\n      loading: {\n        flg: true\n      }\n    };\n    this.handleDeleteAppointment = this.handleDeleteAppointment.bind(this);\n    this.handleDeleteAllAppointment = this.handleDeleteAllAppointment.bind(this);\n    this.handleAppointment = this.handleAppointment.bind(this);\n  }\n\n  fetchAppointment(omsNumber, birthDate) {\n    return fetch(BASE_URL + APPOINTMENT_URL + \"?oms_number=\".concat(omsNumber, \"&birth_date=\").concat(birthDate), {\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    }).then(response => response.json()).then(response => this.setState({\n      departments: response\n    })).catch(err => this.setState({\n      departments: []\n    })).finally(_ => this.setState({\n      loadingFlag: false\n    }));\n  }\n\n  fetchDeleteAppointment(appointmentId, omsNumber, birthDate) {\n    return fetch(BASE_URL + APPOINTMENT_URL + \"/\".concat(appointmentId, \"?oms_number=\").concat(omsNumber, \"&birth_date=\").concat(birthDate), {\n      method: 'DELETE',\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    });\n  }\n\n  handleAppointment() {\n    this.setState(_objectSpread({}, this.state, {\n      loading: {\n        flg: true\n      }\n    }));\n    this.fetchAppointment(localStorage.getItem('omsNumber'), localStorage.getItem('birthDate'));\n  }\n\n  handleDeleteAppointment(appointmentId) {\n    this.fetchDeleteAppointment(appointmentId, localStorage.getItem('omsNumber'), localStorage.getItem('birthDate')).then(() => this.setState(_objectSpread({}, this.state, {\n      departments: this.state.departments.filter(department => department.appointment_id !== appointmentId)\n    })));\n  }\n\n  handleDeleteAllAppointment(doctor) {\n    this.state.departments.filter(department => department.available_resource_id === doctor).map(department => this.fetchDeleteAppointment(department.appointment_id, localStorage.getItem('omsNumber'), localStorage.getItem('birthDate')).then(() => this.setState(_objectSpread({}, this.state, {\n      departments: this.state.departments.filter(department => department.available_resource_id !== doctor)\n    }))));\n  }\n\n  componentDidMount() {\n    this.handleAppointment();\n  }\n\n  render() {\n    const loadPage = React.createElement(\"div\", {\n      className: styles.loadPage,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 62\n      },\n      __self: this\n    }, React.createElement(Spinner, {\n      animation: \"border\",\n      variant: \"primary\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 62\n      },\n      __self: this\n    }));\n\n    if (this.state.loadingFlag) {\n      return loadPage;\n    }\n\n    console.log(this.state);\n    const doctors = [...new Set(this.state.departments.map(x => x.available_resource_id))];\n    const emptyPage = React.createElement(\"h2\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 69\n      },\n      __self: this\n    }, 'У вас пока нет записей!');\n    const page = React.createElement(\"div\", {\n      className: styles.page,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 71\n      },\n      __self: this\n    }, React.createElement(\"ul\", {\n      className: styles.list,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 72\n      },\n      __self: this\n    }, doctors.map(doctor => React.createElement(Tile, {\n      key: doctor,\n      handleDelete: () => this.handleDeleteAllAppointment(doctor),\n      handleDeleteItem: this.handleDeleteAppointment,\n      appointments: this.state.departments.filter(x => x.available_resource_id === doctor),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 75\n      },\n      __self: this\n    }))));\n    return this.state.departments.length === 0 ? emptyPage : page;\n  }\n\n}\n;","map":{"version":3,"sources":["/Users/17476018U/Google Диск/Projects/Frontend/Project/DoctorsFront/src/pages/AppointmentPage.js"],"names":["React","Tile","styles","Spinner","BASE_URL","APPOINTMENT_URL","AppointmentPage","Component","constructor","props","state","departments","loading","flg","handleDeleteAppointment","bind","handleDeleteAllAppointment","handleAppointment","fetchAppointment","omsNumber","birthDate","fetch","headers","then","response","json","setState","catch","err","finally","_","loadingFlag","fetchDeleteAppointment","appointmentId","method","localStorage","getItem","filter","department","appointment_id","doctor","available_resource_id","map","componentDidMount","render","loadPage","console","log","doctors","Set","x","emptyPage","page","list","length"],"mappings":"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","sourcesContent":["import React from 'react';\n\nimport Tile from '../components/Tile/Tile'\n\nimport styles from './AppointmentPage.module.css'\n\nimport Spinner from 'react-bootstrap/Spinner'\n\n\n\nconst BASE_URL = \"https://back-q-doctor.herokuapp.com/api\"\nconst APPOINTMENT_URL = \"/people/appointments\"\n\n\nexport default class AppointmentPage extends React.Component{\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {departments: [], loading: {flg: true}};\n\t\tthis.handleDeleteAppointment = this.handleDeleteAppointment.bind(this);\n\t\tthis.handleDeleteAllAppointment = this.handleDeleteAllAppointment.bind(this);\n\t\tthis.handleAppointment = this.handleAppointment.bind(this);\n\t}\n\n\tfetchAppointment(omsNumber, birthDate) {\n\t\treturn fetch(BASE_URL+APPOINTMENT_URL+`?oms_number=${omsNumber}&birth_date=${birthDate}`,\n\t\t\t\t\t\t\t\t {headers: {'Content-Type': 'application/json'}})\n\t\t\t\t\t\t.then(response => response.json())\n\t\t\t\t\t\t.then(response => this.setState({departments: response}))\n            .catch(err => this.setState({departments: []}))\n            .finally(_ => this.setState({loadingFlag: false}));\n  };\n\n  fetchDeleteAppointment(appointmentId, omsNumber, birthDate) {\n\t\treturn fetch(BASE_URL+APPOINTMENT_URL+`/${appointmentId}?oms_number=${omsNumber}&birth_date=${birthDate}`,\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tmethod: 'DELETE',\n\t\t\t\t\t\t\t\t\t\theaders: {'Content-Type': 'application/json'},\n\t\t\t\t\t\t\t\t\t});\n\t};\n\n\thandleAppointment() {\n    this.setState({...this.state, loading: {flg: true}});\n    this.fetchAppointment(localStorage.getItem('omsNumber'), localStorage.getItem('birthDate'));\n  }\n\n\thandleDeleteAppointment(appointmentId) {\n\t\tthis.fetchDeleteAppointment(appointmentId, localStorage.getItem('omsNumber'), localStorage.getItem('birthDate'))\n\t\t.then(()=>this.setState({...this.state, departments: this.state.departments.filter(department => department.appointment_id !== appointmentId)}));\n\t};\n\n\thandleDeleteAllAppointment(doctor) {\n\t\tthis.state.departments.filter(department => department.available_resource_id === doctor).map(department =>\n\t\t\tthis.fetchDeleteAppointment(department.appointment_id, localStorage.getItem('omsNumber'), localStorage.getItem('birthDate'))\n\t\t\t.then(()=>this.setState({...this.state, departments: this.state.departments.filter(department => department.available_resource_id !== doctor)})));\n\t};\n\n\tcomponentDidMount() {\n\t\tthis.handleAppointment();\n\t}\n\n\trender() {\n\t\tconst loadPage = <div className={styles.loadPage} ><Spinner animation=\"border\" variant=\"primary\" /></div>;\n\t\t\n\t\tif (this.state.loadingFlag) {\n\t\t\treturn loadPage;\n\t\t}\n\t\tconsole.log(this.state)\n\t\tconst doctors = [...new Set(this.state.departments.map(x => x.available_resource_id))];\n\t\tconst emptyPage = <h2>{'У вас пока нет записей!'}</h2>;\n\t\tconst page = (\n\t\t\t<div className={styles.page}>\n\t\t\t<ul className={styles.list}>\n\t\t\t\t{doctors\n\t\t\t\t\t.map(doctor => \n\t\t\t\t\t\t<Tile\n\t\t\t\t\t\t\tkey={doctor}\n\t\t\t\t\t\t\thandleDelete={() => this.handleDeleteAllAppointment(doctor)}\n\t\t\t\t\t\t\thandleDeleteItem={this.handleDeleteAppointment}\n\t\t\t\t\t\t\tappointments={this.state.departments.filter(x => x.available_resource_id === doctor)}\n\t\t\t\t\t\t/>)\n\t\t\t\t}\n\t\t\t</ul>\n\t\t</div>\n\t\t);\n\n\t\treturn  this.state.departments.length === 0 ? emptyPage : page;\n\t};\n};\n"]},"metadata":{},"sourceType":"module"}